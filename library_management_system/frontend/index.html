<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>図書館システム</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div id="app">
        <main class="d-flex flex-nowrap min-vh-100">
            <!-- サイドメニューコンポーネント -->
            <side-menu 
                :current-page="currentPage"
                :is-logged-in="isLoggedIn"
                :current-user="currentUser"
                @page-change="setCurrentPage"
                @logout="logout">
            </side-menu>
            
            <!-- メインコンテンツ -->
            <div class="main p-4 flex-grow-1">
                <!-- TOPページコンポーネント -->
                <top-page 
                    v-if="currentPage === 'top'"
                    :is-logged-in="isLoggedIn"
                    :current-user="currentUser">
                </top-page>
                
                <!-- ログインコンポーネント -->
                <login-form 
                    v-if="currentPage === 'login'"
                    :login-form="loginForm"
                    :is-loading="isLoading"
                    :login-error="loginError"
                    :login-success="loginSuccess"
                    :show-password="showPassword"
                    @login="handleLogin"
                    @toggle-password="showPassword = !showPassword"
                    @page-change="setCurrentPage">
                </login-form>
                
                <!-- 初回認証コンポーネント -->
                <first-auth-form 
                    v-if="currentPage === 'firstAuth'"
                    :first-auth-form="firstAuthForm"
                    @first-auth="handleFirstAuth"
                    @page-change="setCurrentPage">
                </first-auth-form>
                
                <!-- パスワード登録コンポーネント -->
                <set-password-form 
                    v-if="currentPage === 'setPassword'"
                    :password-form="passwordForm"
                    :verified-user="verifiedUser"
                    :show-new-password="showNewPassword"
                    :show-confirm-password="showConfirmPassword"
                    @set-password="handleSetPassword"
                    @toggle-new-password="showNewPassword = !showNewPassword"
                    @toggle-confirm-password="showConfirmPassword = !showConfirmPassword"
                    @page-change="setCurrentPage">
                </set-password-form>

                <!-- ユーザー管理コンポーネント-->
                <user-management
                    v-if="currentPage === 'user-management'"
                    :current-page="currentPage"
                    @page-change="setCurrentPage">
                </user-management>

                <!-- 新規アカウント登録コンポーネント login-user-school=~で作業者の所属校情報を渡す準備-->
                <account-registration
                    v-if="currentPage === 'account-registration'"
                    :login-user-school="currentUser ? currentUser.affiliation : ''" 
                    @back-to-management="setCurrentPage('user-management')">
                </account-registration>

                <!-- アカウントの削除 -->
                <account-deletion
                    v-if="currentPage === 'account-deletion'"
                    @back-to-management="setCurrentPage('user-management')">
                </account-deletion>

                <!-- アカウント情報の変更-->
                <account-modification
                    v-if="currentPage === 'account-modification'"
                    @back-to-management="setCurrentPage('user-management')">
                </account-modification>

                <!-- 資料管理-->
                <material-management
                    v-if="currentPage === 'material-management'"
                    :current-page="currentPage"
                    @page-change="setCurrentPage">
                </material-management>

                <!-- 資料の追加 -->
                <material-registration
                v-if="currentPage === 'material-registration'"
                @back-to-material-management="setCurrentPage('material-management')">
                </material-registration>

            </div>
        </main>
    </div>

    <!-- ※※コンポーネントファイルの読み込み ここから※※ -->
    <script src="components/SideMenu.js"></script>
    <script src="components/TopPage.js"></script>
    <!-- サイドメニュー ログイン関連 ここから -->
    <script src="components/LoginForm.js"></script>
    <script src="components/FirstAuth.js"></script>
    <script src="components/SetPasswordForm.js"></script>
    <!-- サイドメニュー ログイン関連 ここまで -->
    <!-- サイドメニュー アカウント管理 ここから -->
    <script src="components/user_management/UserManagement.js"></script> 
    <script src="components/user_management/AccountRegistration.js"></script>
    <script src="components/user_management/SearchAccounts.js"></script>
    <script src="components/user_management/UserDelete.js"></script>
    <script src="components/user_management/AccountDeletion.js"></script>
    <script src="components/user_management/AccountModification.js"></script>
    <!-- サイドメニュー アカウント管理 ここまで -->

    <!-- サイドメニュー 資料管理 ここから-->
    <script src="components/material_management/MaterialRegistrationStep1.js"></script>
    <script src="components/material_management/MaterialRegistrationStep2.js"></script>
    <script src="components/material_management/material_registration.js"></script>
    <script src="components/material_management/MaterialManagement.js"></script>
    <!-- サイドメニュー 資料管理 ここまで-->

    <!-- ※※コンポーネントファイルの読み込み ここまで※※ -->

    <script src="app.js"></script>
</body>
</html>
