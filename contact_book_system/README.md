# 連絡帳管理システム (Contact Book Management System)

公立中学校向けのデジタル連絡帳管理システムです。紙ベースの連絡帳業務をデジタル化し、学校と保護者間のコミュニケーションを効率化します。

---

## 📑 目次

- [概要](#概要)
- [主な機能](#主な機能)
- [技術スタック](#技術スタック)
- [システム要件](#システム要件)
- [インストール方法](#インストール方法)
- [使用方法](#使用方法)
- [アーキテクチャ](#アーキテクチャ)
- [ユーザー権限](#ユーザー権限)
- [開発履歴](#開発履歴)
- [セキュリティ](#セキュリティ)
- [データ保管・法令遵守](#データ保管法令遵守)
- [トラブルシューティング](#トラブルシューティング)
- [ライセンス](#ライセンス)
- [お問い合わせ](#お問い合わせ)
- [謝辞](#謝辞)

---

## 概要

本システムは、公立中学校における連絡帳業務のデジタル化を目的として開発されました。従来の紙ベースの連絡帳から、Webベースのリアルタイムコミュニケーションシステムへの移行をサポートします。

### 開発目的

- 紙ベースの連絡帳業務の効率化
- 教職員間のリアルタイムコミュニケーション促進
- 生徒情報の一元管理とセキュアな保管
- 過去データの適切なアーカイブと管理

---

## 主な機能

### 🔐 認証・権限管理

- JWT 認証
- ロールベースアクセス制御（RBAC）
  - システム管理者
  - 学年主任
  - 担任教諭
  - 副担任教諭
  - 養護教諭
  - 教科担当教諭

### 📝 連絡帳管理

- 連絡帳の作成・編集・削除
- 生徒別の閲覧
- 学年・クラス単位で管理
- 連絡帳フォームのカスタマイズ

### 💬 リアルタイムチャット

- WebSocket によるリアルタイム通信
- チャットルーム分類（担任、副担任、養護、報連相）
- オンライン/オフライン表示
- 入力中インジケーター
- 未読メッセージ数
- ping/pong による接続監視

### 👤 アカウント管理

- 教職員アカウント作成・編集・削除
- 学年・クラス配属管理
- bcrypt によるパスワードハッシュ

### 🏥 養護教諭専用機能

- 生徒の健康状態確認
- 専用チャットルーム

### 📦 アーカイブ管理

- 卒業生データの自動アーカイブ
- 3年以上経過したデータの自動削除
- 統計情報取得
- ストアドプロシージャによる安全な移行

### 🌐 ブラウザ対応

- 戻る・進む・更新ボタン対応
- SPA ナビゲーション管理

---

## 技術スタック

### フロントエンド

- Vue.js 3
- Bootstrap 5
- WebSocket API

### バックエンド

- FastAPI
- Python 3.x
- SQLAlchemy
- Pydantic
- python-jose
- passlib

### データベース

- MySQL 8.0
- ストアドプロシージャ

### インフラ

- Docker / Docker Compose

---

## システム要件

### 開発環境

- Docker 20.10+
- Docker Compose 2.0+
- Node.js 16+
- Python 3.8+

### 推奨環境

- OS: Linux / macOS / Windows (WSL2)
- メモリ: 4GB 以上
- ストレージ: 10GB 以上

---

## インストール方法

### 1. リポジトリのクローン

```bash
git clone <repository-url>
cd contact_book_system
```

### 2. Docker Compose の起動

```bash
docker-compose up -d
docker exec -i renrakucho_mysql mysql -uroot -prootpass renrakucho_db < init.sql
```

### 3. バックエンド起動

```bash
cd backend
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

### 4. フロントエンド起動

```bash
cd frontend_ver2
python -m http.server 3000
```

### 5. アクセス

- フロント: [http://localhost:3000](http://localhost:3000)
- API: [http://localhost:8000](http://localhost:8000)
- API Docs: [http://localhost:8000/docs](http://localhost:8000/docs)

---

## 使用方法

### 初回セットアップ

- `python info_registration.py` にて管理者作成
- 管理画面から教職員アカウント登録
- 学年・クラス設定

### 日常利用

- ログイン
- 連絡帳閲覧・作成
- チャット機能利用
- アーカイブ（管理者）

---

## アーキテクチャ

※ 図は README では省略せずそのまま使用可能

```
(図をそのまま掲載)
```

---

## ユーザー権限

権限マトリクス・役職別機能一覧をそのまま表形式で掲載

---

## 開発履歴

### 2025年11月

#### 11/4

- 採用インターン課題提出内容の復習・見直しを開始

#### 11/11

- **ブラウザ機能対応**
  - 戻る・進む・更新ボタンへの対応（`app.js` を更新）
- **チャット機能強化**
  - チャットルーム参加者の表示機能を追加（`ChatRoom.js` を更新）
  - 参加者のオンライン/オフライン表示機能を追加（`ChatRoom.js` を更新）
- **WebSocket 通信**
  - 対象アカウントとの通信状況の定期確認（ping）を実装

#### 11/12

- **WebSocket 通信管理**
  - チャットルーム・養護教諭専用ページ退出時に WebSocket 通信を自動切断してバックエンドへ通知する設定を追加
  - バックエンドで上記通知を受け取り処理する機能を追加
- **チャット機能拡張**
  - リアルタイムでのメッセージ更新を実装
  - 入力中の表示を実装
  - 未読メッセージ数の表示を実装

#### 11/14

- **ヘッダー表示の調整**
  - 学年主任：学年のみ表示
  - 養護教諭・教科担当：学年・組ともに非表示
- **権限設定の調整**
  - 学年主任ログイン時、一時的に担任・副担任と同じ機能を使えるように設定
  - 教科担当ログイン時は報連相部屋（仮）のみ使えるように設定
- **アカウント管理**
  - アカウント情報検索時に管理者権限のアカウントを除外するように設定
- **連絡帳フォーム**
  - 連絡帳フォームの構成を更新
- **養護教諭機能**
  - ログイン時にメインメニューを表示するように変更
  - 報連相（仮）、生徒の状況確認（仮）を設定
- **アーカイブシステム**
  - 卒業生の連絡帳管理システムの構築を開始（`卒業生の連絡帳情報管理システム.md` を参考）
  - アーカイブ・削除テーブルを作成

#### 11/17

- **データベース設計**
  - アーカイブ・削除・データ統計取得プロシージャを作成
- **UI 開発**
  - システム管理者用のアーカイブ管理用コンポーネントを作成
- **開発環境改善**
  - Prettier が正常に機能していなかった問題を解決

#### 11/18

- **スケジュールイベント**
  - 年次アーカイブイベントを作成
  - 年次削除イベントを作成
- **バックエンド開発**
  - `archive_schema.py` を作成（Null 許容型・ユニオン型に変更）
  - `archive_service.py` を作成
- **データベース管理**
  - プロシージャへのアクセス権限を持ったユーザーを作成
  - アーカイブ管理用コンポーネントからデータベースへアクセスできたことを確認

---

**開発開始日**: 2025-11-04  
**記録開始日**: 2025-11-11

---

## セキュリティ

- JWT 認証
- bcrypt パスワードハッシュ
- RBAC
- CORS 設定
- SQLAlchemy による SQL インジェクション対策
- ストアドプロシージャ安全運用

推奨（本番）：HTTPS，レート制限，監査ログ

---

## データ保管・法令遵守

- 個人情報保護法準拠
- 公文書管理法ガイドライン対応
- 保存期間ポリシー
- アーカイブ処理ルール

---

最終更新日: 2025-11-18
開発者: 安 成鎔
バージョン: 1.0.0-beta
